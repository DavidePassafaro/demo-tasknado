<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>My Dashboard</h1>
    <p>Track and manage all your tasks from here</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-value">{{ statistics().todo }}</div>
      <div class="stat-label">To Do</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().inProgress }}</div>
      <div class="stat-label">In Progress</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().completed }}</div>
      <div class="stat-label">Completed</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().total }}</div>
      <div class="stat-label">Total Tasks</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().completionRate }}%</div>
      <div class="stat-label">Completion Rate</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().averageTasksPerDay }}</div>
      <div class="stat-label">Tasks/Day (avg)</div>
    </div>
  </div>

  <!-- Advanced Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <input
        type="text"
        placeholder="Search tasks..."
        [value]="searchTerm()"
        (input)="onSearchChange($event.target.value)"
        class="search-input"
      />
    </div>

    <div class="filter-group">
      <select
        [value]="statusFilter()"
        (change)="onStatusFilterChange($any($event).target.value)"
        class="filter-select"
      >
        <option value="">All Status</option>
        <option value="todo">To Do</option>
        <option value="in_progress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
    </div>

    <div class="filter-group">
      <select
        [value]="sortBy()"
        (change)="onSortChange($any($event).target.value, sortOrder())"
        class="filter-select"
      >
        <option value="date">Sort by Date</option>
        <option value="title">Sort by Title</option>
        <option value="status">Sort by Status</option>
      </select>
    </div>

    <div class="filter-group">
      <button
        class="sort-order-btn"
        [title]="'Sort ' + sortOrder()"
        (click)="onSortChange(sortBy(), sortOrder() === 'asc' ? 'desc' : 'asc')"
      >
        {{ sortOrder() === 'asc' ? '↑' : '↓' }}
      </button>
    </div>

    <button class="reset-btn" (click)="resetFilters()">Reset Filters</button>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-state">
    <p>Loading your tasks...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="error-state">
    <p>{{ error() }}</p>
  </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && !error() && filteredTasks().length === 0) {
  <div class="empty-state">
    <p>
      @if (searchTerm() || statusFilter()) { No tasks match your filters. Try adjusting your search.
      } @else { No tasks found. Create your first task in a project! }
    </p>
  </div>
  }

  <!-- Tasks List -->
  @if (!isLoading() && !error() && filteredTasks().length > 0) {
  <div class="tasks-section">
    <h2>Tasks ({{ filteredTasks().length }})</h2>

    <cdk-virtual-scroll-viewport [itemSize]="121" class="tasks-virtual-scroll">
      <div class="tasks-vertical">
        <div *cdkVirtualFor="let task of filteredTasks(); trackBy: trackByTaskId">
          <tn-task-card
            [task]="task"
            (taskDeleted)="deleteTask($event)"
            (taskToggled)="toggleTask($event)"
            (taskSelected)="onTaskSelected($event)"
          />
        </div>
      </div>
    </cdk-virtual-scroll-viewport>
  </div>
  }
</div>
