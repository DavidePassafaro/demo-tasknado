<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>My Dashboard</h1>
    <p>Track and manage all your tasks from here</p>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-value">{{ statistics().todo }}</div>
      <div class="stat-label">To Do</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().inProgress }}</div>
      <div class="stat-label">In Progress</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().completed }}</div>
      <div class="stat-label">Completed</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().total }}</div>
      <div class="stat-label">Total Tasks</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().completionRate }}%</div>
      <div class="stat-label">Completion Rate</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ statistics().averageTasksPerDay }}</div>
      <div class="stat-label">Tasks/Day (avg)</div>
    </div>
  </div>

  <!-- Advanced Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <input
        type="text"
        placeholder="Search tasks..."
        [value]="searchTerm()"
        (input)="onSearchChange($event.target.value)"
        class="search-input"
      />
    </div>

    <div class="filter-group">
      <select
        [value]="statusFilter()"
        (change)="onStatusFilterChange($any($event).target.value)"
        class="filter-select"
      >
        <option value="">All Status</option>
        <option value="todo">To Do</option>
        <option value="in_progress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
    </div>

    <div class="filter-group">
      <select
        [value]="sortBy()"
        (change)="onSortChange($any($event).target.value, sortOrder())"
        class="filter-select"
      >
        <option value="date">Sort by Date</option>
        <option value="title">Sort by Title</option>
        <option value="status">Sort by Status</option>
      </select>
    </div>

    <div class="filter-group">
      <button
        class="sort-order-btn"
        [title]="'Sort ' + sortOrder()"
        (click)="onSortChange(sortBy(), sortOrder() === 'asc' ? 'desc' : 'asc')"
      >
        {{ sortOrder() === 'asc' ? 'â†‘' : 'â†“' }}
      </button>
    </div>

    <button class="reset-btn" (click)="resetFilters()">Reset Filters</button>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <p>Loading your tasks...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <p>{{ error() }}</p>
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && !error() && filteredTasks().length === 0) {
    <div class="empty-state">
      <p>
        @if (searchTerm() || statusFilter()) {
          No tasks match your filters. Try adjusting your search.
        } @else {
          No tasks found. Create your first task in a project!
        }
      </p>
    </div>
  }

  <!-- Tasks List -->
  @if (!isLoading() && !error() && filteredTasks().length > 0) {
    <div class="tasks-section">
      <div class="tasks-header">
        <h2>Tasks ({{ filteredTasks().length }})</h2>
        <span class="tasks-subtitle">{{ statistics().completionRate }}% complete</span>
      </div>
      
      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" [style.width.%]="statistics().completionRate"></div>
        </div>
      </div>

      <cdk-virtual-scroll-viewport [itemSize]="100" class="tasks-list">
        @for (task of filteredTasks(); track task.id) {
          <div class="task-card" [ngClass]="getStatusClass(task.status)">
            <!-- Status Indicator -->
            <div class="status-indicator" [ngClass]="getStatusClass(task.status)"></div>
            
            <div class="task-content">
              <div class="task-header">
                <div class="task-title-section">
                  <h3>{{ task.title }}</h3>
                  <span class="status-badge" [ngClass]="getStatusClass(task.status)">
                    {{ task.status | uppercase }}
                  </span>
                </div>
              </div>
              
              @if (task.description) {
                <p class="task-description">{{ task.description }}</p>
              }
              
              <div class="task-meta">
                <div class="meta-left">
                  <span class="project-tag" [style.backgroundColor]="'#6366f1'">
                    <span class="icon">ðŸ“‹</span>
                    Project #{{ task.projectId }}
                  </span>
                  <span class="date-tag">
                    <span class="icon">ðŸ“…</span>
                    {{ task.createdAt | date: 'MMM d, y' }}
                  </span>
                </div>
              </div>
            </div>
            
            <div class="task-actions">
              <button
                class="action-btn toggle-btn"
                [title]="task.status === 'completed' ? 'Mark as incomplete' : 'Mark as complete'"
                [attr.aria-label]="task.status === 'completed' ? 'Mark as incomplete' : 'Mark as complete'"
                (click)="toggleTask(task.id)"
              >
                <span class="btn-icon">{{ task.status === 'completed' ? 'âœ“' : 'â—‹' }}</span>
              </button>
              <button
                class="action-btn view-btn"
                title="View task details"
                aria-label="View task details"
                (click)="goToProject(task)"
              >
                <span class="btn-icon">â†’</span>
              </button>
              <button
                class="action-btn delete-btn"
                title="Delete task"
                aria-label="Delete task"
                (click)="deleteTask(task.id)"
              >
                <span class="btn-icon">ðŸ—‘</span>
              </button>
            </div>
          </div>
        }
      </cdk-virtual-scroll-viewport>
    </div>
  }
</div>


